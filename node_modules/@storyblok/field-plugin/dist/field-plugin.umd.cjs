(function(n,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(n=typeof globalThis<"u"?globalThis:n||self,i(n.FieldPlugin={}))})(this,function(n){"use strict";const i=(e,t)=>typeof e=="object"&&e!==null&&t in e,f=e=>i(e,"name")&&typeof e.name=="string"&&i(e,"value")&&typeof e.value=="string",y=e=>i(e,"field_type")&&typeof e.field_type=="string"&&i(e,"options")&&Array.isArray(e.options)&&e.options.every(f),l=e=>i(e,"action")&&typeof e.action=="string"&&i(e,"uid")&&typeof e.uid=="string",u=e=>i(e,"content")&&typeof e.content=="object"&&e.content!==null&&!Array.isArray(e.content),p=e=>l(e)&&i(e,"language")&&typeof e.language=="string"&&e.action==="loaded"&&i(e,"schema")&&y(e.schema)&&i(e,"story")&&u(e.story),M=e=>e.reduce((t,o)=>(t[o.name]=o.value,t),{}),v=e=>i(e,"filename")&&typeof e.filename=="string",m=e=>{const{uid:t,action:o,field:s,...r}=e;return r},C=e=>l(e)&&e.action==="asset-selected"&&w(e)&&v(e),w=e=>!i(e,"field")||typeof e.field>"u"?!0:typeof e.field=="string",P=e=>l(e)&&e.action==="get-context"&&i(e,"story")&&u(e.story),c=e=>i(e,"action")&&e.action==="plugin-changed"&&i(e,"uid")&&typeof e.uid=="string"&&i(e,"event")&&typeof e.event=="string",q=e=>c(e)&&e.event==="update"&&i(e,"model"),S=(e,t)=>({action:"plugin-changed",event:"update",uid:e,model:t}),$=e=>c(e)&&e.event==="toggleModal"&&i(e,"status")&&typeof e.status=="boolean",F=(e,t)=>({action:"plugin-changed",event:"toggleModal",uid:e,status:t}),I=e=>c(e)&&e.event==="loaded",A=e=>({action:"plugin-changed",event:"loaded",uid:e}),T=e=>c(e)&&e.event==="heightChange"&&i(e,"height")&&typeof e.height=="number",L=(e,t)=>({action:"plugin-changed",event:"heightChange",uid:e,height:t}),_=e=>c(e)&&e.event==="getContext",R=e=>({action:"plugin-changed",event:"getContext",uid:e}),z=e=>c(e)&&e.event==="showAssetModal"&&D(e),D=e=>!i(e,"field")||typeof e.field>"u"?!0:typeof e.field=="string",k=(e,t)=>({action:"plugin-changed",event:"showAssetModal",uid:e,field:t}),H=e=>`${e.secure?"https":"http"}://${e.host}`,O=e=>{const t=new URLSearchParams(e),o=t.get("uid")??void 0,s=t.get("protocol")??void 0,r=t.get("host")??void 0,d=t.get("preview")??void 0;return s!=="http:"&&s!=="https:"||typeof o>"u"||typeof r>"u"?void 0:{uid:o,secure:s==="https:",host:r,preview:typeof d<"u"}},G=e=>{const t=new URLSearchParams({protocol:e.secure?"https:":"http:",host:e.host,uid:e.uid});return e.preview&&t.set("preview","1"),t.toString()},V=e=>({spaceId:e.spaceId??void 0,story:e.story??void 0,storyId:e.storyId??void 0,storyLang:e.language===""?"default":e.language,blockUid:e.blockId??void 0,token:e.token??void 0,options:M(e.schema.options),uid:e.uid??void 0,content:e.model??void 0}),B=e=>({story:e.story??void 0}),J={isModalOpen:!1,content:void 0,options:{},storyLang:"default",story:{content:{}},blockUid:void 0,storyId:void 0,token:void 0,uid:"-preview",spaceId:void 0},K=(e,t,o)=>{let s=J,r;return{actions:{setContent:a=>{const g=typeof a=="function"?a(s.content):a;t(S(e,g)),s={...s,content:g},o(s)},setModalOpen:a=>{const g=typeof a=="function"?a(s.isModalOpen):a;t(F(e,g)),s={...s,isModalOpen:g},o(s)},selectAsset:()=>new Promise(a=>{r=a,t(k(e))}),requestContext:()=>t(R(e))},messageCallbacks:{onStateChange:a=>{s={...s,...V(a)},o(s)},onContextRequest:a=>{s={...s,...B(a)},o(s)},onAssetSelect:a=>{r==null||r(m(a))},onUnknownMessage:a=>{console.debug(`Plugin received a message from container of an unknown action type "${a.action}". You may need to upgrade the version of the @storyblok/field-plugin library. Full message: ${JSON.stringify(a)}`)}}}},N=(e,t)=>{const o=()=>{t(L(e,document.body.clientHeight))},s=new ResizeObserver(o);return s.observe(document.body),()=>{s.disconnect()}},Q=()=>{const e=document==null?void 0:document.querySelector('link[href^="https://plugins.storyblok.com"]');return e==null||e.setAttribute("disabled",""),()=>{e==null||e.removeAttribute("disabled")}},Y=(e,t,o)=>{l(e)&&e.uid===t&&(p(e)?o.onStateChange(e):P(e)?o.onContextRequest(e):C(e)?o.onAssetSelect(e):o.onUnknownMessage(e))},W=(e,t)=>{const o=s=>{Y(s.data,e,t)};return window.addEventListener("message",o,!1),()=>{window.removeEventListener("message",o,!1)}},X="https://plugin-sandbox.storyblok.com/field-plugin/",Z=()=>{const e=new URLSearchParams({url:window.location.href}).toString();return`${X}?${e}`},x=e=>{if(!(window.parent!==window))return e({type:"error",error:new Error(`The window is not embedded within another window. Did you mean to open the field plugin in the sandbox? ${Z()}`)}),()=>{};const o=O(window.location.search);if(!o)return e({type:"error",error:new Error("The URL parameters does not match the expected format.")}),()=>{};const{uid:s}=o,r=a=>{const g="*";window.parent.postMessage(a,g)},d=N(s,r),h=Q(),{actions:E,messageCallbacks:b}=K(s,r,a=>{e({type:"loaded",data:a,actions:E})});r(A(s));const U=W(o.uid,b);return()=>{U(),d(),h()}};n.assetFromAssetSelectedMessage=m,n.assetModalChangeMessage=k,n.createFieldPlugin=x,n.getContextMessage=R,n.hasField=w,n.heightChangeMessage=L,n.isAsset=v,n.isAssetModalChangeMessage=z,n.isAssetSelectedMessage=C,n.isContextRequestMessage=P,n.isFieldPluginOption=f,n.isFieldPluginSchema=y,n.isGetContextMessage=_,n.isHeightChangeMessage=T,n.isMessageToContainer=c,n.isMessageToPlugin=l,n.isModalChangeMessage=$,n.isPluginLoadedMessage=I,n.isStateChangedMessage=p,n.isStoryData=u,n.isValueChangeMessage=q,n.modalChangeMessage=F,n.originFromPluginParams=H,n.pluginLoadedMessage=A,n.pluginUrlParamsFromUrl=O,n.recordFromFieldPluginOptions=M,n.urlSearchParamsFromPluginUrlParams=G,n.valueChangeMessage=S,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
